# Solanon

Solanon is a Solana-based tumbler project designed to enhance transaction privacy by mixing user deposits in a common pool. By decoupling the direct link between deposit and withdrawal, Solanon aims to obscure the origin and destination of funds on the blockchain.

---

## Description

In traditional blockchain transactions, every transfer is publicly recorded, potentially exposing a user's transaction history and linking addresses together. Solanon addresses these concerns through the following process:

- **Deposit Phase:**  
  Users transfer a specified amount of SOL into the tumbler’s pool. Along with the deposit, a commitment is generated by hashing the deposit amount and a user-provided 32-byte secret. The generated commitment is then stored in the on-chain mixer state.

- **State Management:**  
  The project uses a simplified Merkle tree approach to manage deposit commitments and track spent nullifiers. Although the current implementation simplifies the Merkle tree logic, the design leaves room for future enhancements to provide stronger obfuscation and security guarantees.

- **Withdrawal Phase:**  
  To withdraw funds, a user must supply a 32-byte nullifier along with a corresponding Merkle proof. The program verifies that the provided nullifier is included in the stored commitments (by matching it against the current Merkle root) and that it has not been used before. Once verified, the nullifier is marked as spent, preventing double withdrawals.

By mixing deposits and requiring users to prove inclusion of their deposit via a secret hash and Merkle proof, Solanon enhances privacy by breaking direct links between deposit and withdrawal addresses.

---

## Features

- **Built on Anchor:**  
  Uses the Anchor framework for a cleaner account context, automatic serialization/deserialization, and integrated testing.

- **Commitment Generation:**  
  Generates a 32-byte commitment for each deposit by hashing the deposit amount together with a secret.

- **Simplified Merkle Proof Verification:**  
  Uses a simplified implementation of Merkle proof verification to validate withdrawals and prevent double spending via nullifiers.

- **Modular Design:**  
  The project is divided into four modules:  
  - **utils.rs:** Contains helper functions for commitment generation and Merkle proof verification.  
  - **state.rs:** Defines the mixer state account using Anchor’s `#[account]` macro.  
  - **instructions.rs:** Implements the deposit and withdrawal instructions.  
  - **lib.rs:** Serves as the program entry point, connecting all modules.

---

## Installation & Usage

### Prerequisites

- **Rust Toolchain:** Use the latest stable version.  
- **Solana CLI:** Ensure you have an updated version of Solana CLI.  
- **Anchor CLI:** Install via npm:
  ```bash
  npm install -g @project-serum/anchor-cli
  ```
- **Operating System:** Linux, MacOS, or WSL 2 (for Windows users).

### Project Setup

1. **Clone the Repository:**
   ```bash
   git clone https://github.com/Klinola/solanon.git
   cd solanon
   ```

2. **Build the Project:**
   ```bash
   anchor build
   ```

3. **Deploy to a Local Test Validator:**
   - Start the local test validator:
     ```bash
     solana-test-validator
     ```
   - Open a new terminal and deploy:
     ```bash
     anchor deploy
     ```

4. **Run Tests:**
   ```bash
   anchor test
   ```

### How to Use

- **Deposit Operation:**  
  Call the `deposit` instruction with the desired deposit amount (in lamports) and a 32-byte secret. The tumbler will transfer funds to its pool and generate a commitment stored on-chain.

- **Withdrawal Operation:**  
  Call the `withdraw` instruction providing a 32-byte nullifier and the corresponding Merkle proof. The program will verify the proof and mark the nullifier as spent, completing the withdrawal process.

Consult the project's generated IDL and TypeScript tests for more details on how to interact with these instructions.